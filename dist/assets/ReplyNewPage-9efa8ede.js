import{d as V,g as i,n as u,h as x,r as g,o as l,c as n,a as c,w as _,b as s,t as q,q as v,l as M,e as T,f as j,S as J,k as P,u as L,x as I,p as U,m as W,_ as Y}from"./index-6aaf6acf.js";import{F as z}from"./FileUpload-4c08f7c5.js";import{M as G}from"./MetaForm-197e38e5.js";import{P as H}from"./PaperInfo-b25b6f5f.js";import{D as K}from"./DeSciPrint-fa65339c.js";import{C as O}from"./index-24014245.js";import"./upload-ad8f6267.js";const w=d=>(U("data-v-543b85cf"),d=d(),W(),d),Q={class:"common-layout"},X={key:0,class:"text-danger"},Z={key:1,class:"text-danger"},$={key:2,class:"container"},ee=w(()=>s("h3",null,"Previous version of the paper:",-1)),te=w(()=>s("div",{class:"divider"},null,-1)),se={class:"file-upload-container"},ae={class:"container mt-4"},oe=["onSubmit"],re={class:"row mt-2"},le=w(()=>s("div",{class:"col-12 col-sm-8"},[s("button",{id:"contractCall",type:"submit",class:"btn btn-primary"},"Submit")],-1)),ie={class:"col-12 col-sm-4 mt-2 mt-sm-0"},ne={key:0,class:"text-danger"},ce={key:1,class:"text-success"},de=V({__name:"ReplyNewPage",props:{address:{type:String,required:!0},prevCID:{type:String,required:!0}},async setup(d){let e,a;const o=d,t=i(),{provider:f}=([e,a]=u(()=>L()),e=await e,a(),e),p=new O(o.address,K.abi,f);let N=i(([e,a]=u(()=>p.name()),e=await e,a(),e)),h=i(!1),y=i(!1),D=x(([e,a]=u(()=>p.deSciPrints(o.prevCID)),e=await e,a(),e));const E=i(([e,a]=u(()=>f.getSigner().getAddress()),e=await e,a(),e)),F=i(E.value===D.submitAddress);let A=x(([e,a]=u(()=>p.deSciProcess(o.prevCID)),e=await e,a(),e));const B=async()=>{const C={authors:t.value.authors,fields:t.value.fields,title:t.value.title,abstract:t.value.abstract},k=f.getSigner(),S=p.connect(k);let m=I(t.value.donate),b=I(t.value.gas),R=m.add(b);try{await S.replyNew(o.prevCID,t.value.cid,t.value.title,C,m,{value:R}),y.value=!0,h.value=!1}catch(r){console.error(r),h.value=!0,y.value=!1}finally{t.value.authors.forEach(r=>{r.name="",r.email="",r.workplace=""}),t.value.fields.forEach(r=>{r.field=""}),t.value.title="",t.value.abstract="",t.value.cid=""}};return(C,k)=>{const S=g("el-header"),m=g("el-main"),b=g("el-container");return l(),n("div",Q,[c(b,null,{default:_(()=>[c(S,null,{default:_(()=>[s("h2",null,"Journal: "+q(v(N)),1)]),_:1}),c(m,null,{default:_(()=>[F.value?v(A).processStatus!=5?(l(),n("div",Z,"The status of this paper must be NeedRevise")):(l(),n("div",$,[s("div",null,[ee,c(H,{cid:o.prevCID,address:o.address},null,8,["cid","address"])]),te,s("div",se,[c(z)]),s("div",ae,[s("form",{onSubmit:M(B,["prevent"])},[(l(),T(J,null,{fallback:_(()=>[j(" Loading... ")]),default:_(()=>[c(G,{address:o.address,ref_key:"metaForm",ref:t},null,8,["address"])]),_:1})),s("div",re,[le,s("div",ie,[v(h)?(l(),n("div",ne,"Submit failed")):P("",!0),v(y)?(l(),n("div",ce,"Submit succeed")):P("",!0)])])],40,oe)])])):(l(),n("div",X,"You are not the author of this paper"))]),_:1})]),_:1})])}}});const ye=Y(de,[["__scopeId","data-v-543b85cf"]]);export{ye as default};
